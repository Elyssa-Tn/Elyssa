import { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import { initializeElections } from "./reducers/electionReducer";

import Layout from "./Layout";
import ModalContents from "./ModalContents/ModalContents";
import MapCard from "./MapCard/MapCard2";
import Navbar from "./Navbar";
import MapTitle from "./MapTitle";
import { CssBaseline, CssVarsProvider, Divider } from "@mui/joy";
import theme from "./theme";

function App() {
  const dispatch = useDispatch();

  const init = useSelector((state) => state.elections.init);

  // const maps = useSelector((state) => state.maps.maps);
  const map = {
    1: {
      election: {
        pays: "Tunisie",
        type_election: "TNMUN",
        mode_scrutin: "Proportionnel",
        nombre_tours: 1,
        uninominal_liste: "Scrutin de listes",
        age_minimum_electeur: 18,
        age_maximum_electeur: null,
        territorial_national: false,
        partiel_general: "Générale",
        age_minimum_candidat: 23,
        age_maximum_candidat: null,
        militaires: null,
        juges: null,
        autres_exclus: null,
        parite: null,
        jeunesse: null,
        debut: "2018-05-06",
        fin: "2018-05-06",
        date_campagne: "2018-04-14",
        date_decret_officiel: "2018-05-04",
        date_loi_electorale: "2014-05-26",
        date_constitution: "2014-02-10",
        date_planifiee: "2017-12-17",
        description: "",
        silence: "2018-05-05",
        code_election: "tnmun2018",
        nom: "Elections municipales 2018",
        nombre_sieges: null,
        rcno: 8,
        decoupage_minimum: "commune",
        decoupage_maximum: "delegation",
        decoupages_consultables: null,
        version_administratif: null,
      },
      parti: {
        code_parti: "NIDA",
        denomination: null,
        type: null,
        groupement: null,
        an_creation: null,
        pays: "Tunisie",
        rcno: 20,
        description: null,
        sigle: null,
        logo: null,
        classement_politique: null,
        denomination_ar: "حركة نداء تونس",
        denomination_fr: "Nidaa Tounes",
      },
      gouvernorat: {
        data: {
          type: "data",
          code_election: "tnmun2018",
          decoupage: "gouvernorat",
          variables: [
            {
              code_variable: "prc",
              code_parti: "NIDA",
              resultat: {
                11: 26.17,
                12: 20.9,
                13: 20.41,
                14: 22.48,
                15: 22.18,
                16: 19.48,
                17: 20,
                21: 24.05,
                22: 30.95,
                23: 30.5,
                24: 18.16,
                31: 21.21,
                32: 22.21,
                33: 24.18,
                34: 19.28,
                41: 21.46,
                42: 23.69,
                43: 20.52,
                51: 13.76,
                52: 12.08,
                53: 11.53,
                61: 16.94,
                62: 12.08,
                63: 10.9,
                Total: 21,
              },
            },
            {
              code_variable: "voix",
              code_parti: "NIDA",
              resultat: {
                11: 37460,
                12: 16357,
                13: 19752,
                14: 11256,
                15: 34197,
                16: 6986,
                17: 15061,
                21: 10579,
                22: 15308,
                23: 12553,
                24: 6897,
                31: 24238,
                32: 26934,
                33: 17538,
                34: 31872,
                41: 17721,
                42: 19891,
                43: 14955,
                51: 8222,
                52: 9269,
                53: 1909,
                61: 10687,
                62: 2853,
                63: 3391,
                Total: 375886,
              },
            },
          ],
        },
      },
      delegation: {
        data: {
          type: "data",
          code_election: "tnmun2018",
          decoupage: "delegation",
          variables: [
            {
              code_variable: "prc",
              code_parti: "NIDA",
              resultat: {
                1151: 31.68,
                1152: 24.51,
                1153: 31.79,
                1154: 23.94,
                1155: 28.12,
                1156: 24.07,
                1157: 24.48,
                1158: 35.57,
                1159: 29.17,
                1160: 19.37,
                1161: 21.03,
                1162: 30.21,
                1163: 22.93,
                1164: 22.38,
                1165: 21.9,
                1166: 22.91,
                1167: 26.0,
                1168: 28.98,
                1169: 34.61,
                1170: 38.6,
                1171: 17.17,
                1251: 16.49,
                1252: 23.35,
                1253: 16.89,
                1254: 37.19,
                1255: 23.77,
                1256: 26.7,
                1257: 22.86,
                1351: 20.5,
                1352: 23.7,
                1353: 15.38,
                1354: 34.14,
                1355: 20.87,
                1356: 21.47,
                1357: 13.91,
                1358: 25.57,
                1359: 17.68,
                1360: 15.3,
                1361: 15.25,
                1362: 24.34,
                1451: 16.79,
                1452: 25.11,
                1453: 25.56,
                1454: 24.11,
                1455: 43.93,
                1456: 11.67,
                1457: 21.95,
                1458: 36.66,
                1551: 23.35,
                1552: 22.73,
                1553: 21.75,
                1554: 23.81,
                1555: 18.8,
                1556: 35.5,
                1557: 21.3,
                1558: 19.62,
                1559: 21.52,
                1560: 28.66,
                1561: 16.58,
                1562: 26.94,
                1563: 18.79,
                1564: 29.24,
                1565: 24.9,
                1566: 15.38,
                1651: 17.02,
                1652: 31.88,
                1653: 7.72,
                1654: 17.68,
                1655: 21.33,
                1656: 24.35,
                1751: 15.71,
                1752: 20.52,
                1753: 19.17,
                1754: 28.52,
                1755: 25.33,
                1756: 40.34,
                1757: 32.52,
                1758: 19.15,
                1759: 11.54,
                1760: 24.33,
                1761: 15.41,
                1762: 12.19,
                1763: 16.56,
                1764: 16.98,
                2151: 19.85,
                2152: 21.88,
                2153: 31.53,
                2154: 18.37,
                2155: 32.85,
                2156: 49.05,
                2157: 22.43,
                2158: 33.41,
                2159: 26.96,
                2251: 25.69,
                2252: 37.51,
                2253: 28.76,
                2254: 11.01,
                2255: 52.07,
                2256: 34.43,
                2257: 22.6,
                2258: 53.31,
                2259: 46.86,
                2351: 29.53,
                2352: 31.17,
                2353: 35.07,
                2354: 32.7,
                2355: 22.35,
                2356: 23.88,
                2357: 11.52,
                2358: 47.67,
                2359: 21.44,
                2360: 32.67,
                2361: 45.25,
                2451: 15.56,
                2452: 30.75,
                2453: 23.13,
                2454: 20.81,
                2455: 12.22,
                2456: 22.21,
                2457: 22.92,
                2458: 23.56,
                2459: 11.56,
                2460: 4.88,
                2461: 12.83,
                3151: 22.14,
                3152: 18.68,
                3153: 22.88,
                3154: 29.36,
                3155: 16.46,
                3156: 32.69,
                3157: 11.35,
                3158: 7.37,
                3159: 22.81,
                3160: 16.46,
                3161: 32.87,
                3162: 30.57,
                3163: 56.89,
                3164: 14.51,
                3165: 18.17,
                3166: 28.28,
                3251: 16.32,
                3252: 32.8,
                3253: 24.22,
                3254: 13.12,
                3255: 24.26,
                3256: 24.58,
                3257: 32.96,
                3258: 24.98,
                3259: 14.88,
                3260: 12.72,
                3261: 17.24,
                3262: 19.53,
                3263: 39.08,
                3351: 18.26,
                3352: 14.79,
                3353: 24.76,
                3354: 33.33,
                3355: 31.65,
                3356: 32.24,
                3357: 39.92,
                3358: 16.29,
                3359: 34.02,
                3360: 36.98,
                3361: 14.6,
                3451: 16.51,
                3452: 15.48,
                3453: 13.99,
                3454: 14.94,
                3455: 15.65,
                3456: 27.45,
                3457: 38.94,
                3458: 28.14,
                3459: 20.13,
                3460: 21.23,
                3461: 21.06,
                3462: 57.57,
                3463: 17.32,
                3464: 21.26,
                3465: 25.37,
                3466: 15.36,
                4151: 18.67,
                4152: 19.16,
                4153: 18.19,
                4154: 28.71,
                4155: 18.44,
                4156: 25.47,
                4157: 23.31,
                4158: 16.61,
                4159: 10.61,
                4160: 35.96,
                4161: 25.78,
                4251: 30.14,
                4252: 5.99,
                4253: 32.46,
                4254: 23.25,
                4255: 16.15,
                4256: 42.58,
                4257: 3.63,
                4258: 18.62,
                4259: 27.17,
                4260: 35.38,
                4261: 27.94,
                4262: 9.25,
                4263: 32.2,
                4351: 27.33,
                4352: 26.48,
                4353: 17.93,
                4354: 17.97,
                4355: 13.64,
                4356: 18.28,
                4357: 9.74,
                4358: 15.18,
                4359: 8.88,
                4360: 25.69,
                4361: 28.89,
                5151: 18.6,
                5152: 10.59,
                5153: 11.61,
                5154: 14.42,
                5155: 13.11,
                5156: 19.13,
                5157: 9.87,
                5158: 6.36,
                5159: 16.91,
                5160: 16.01,
                5251: 9.18,
                5252: 13.2,
                5253: 23.32,
                5254: 3.32,
                5255: 22.41,
                5256: 6.97,
                5257: 6.86,
                5258: 13.55,
                5259: 18.22,
                5351: 5.09,
                5352: 8.53,
                5353: 20.22,
                5355: 9.83,
                5356: 19.31,
                5357: 31.98,
                6151: 46.08,
                6152: 13.48,
                6153: 17.53,
                6154: 18.74,
                6155: 17.8,
                6156: 11.94,
                6157: 11.5,
                6159: 9.7,
                6160: 20.33,
                6161: 21.14,
                6251: 12.63,
                6252: 11.72,
                6253: 6.92,
                6254: 11.08,
                6255: 19.21,
                6351: 9.16,
                6352: 13.85,
                6353: 12.46,
                6354: 4.64,
                6355: 16.3,
                6356: 10.47,
                Total: 21.0,
              },
            },
            {
              code_variable: "voix",
              code_parti: "NIDA",
              resultat: {
                1151: 2567,
                1152: 884,
                1153: 1740,
                1154: 952,
                1155: 1304,
                1156: 1541,
                1157: 765,
                1158: 4256,
                1159: 2275,
                1160: 2534,
                1161: 139,
                1162: 1729,
                1163: 2137,
                1164: 1899,
                1165: 900,
                1166: 1909,
                1167: 668,
                1168: 541,
                1169: 2540,
                1170: 2918,
                1171: 3262,
                1251: 4846,
                1252: 3291,
                1253: 2097,
                1254: 1875,
                1255: 884,
                1256: 1773,
                1257: 1591,
                1351: 1079,
                1352: 1568,
                1353: 2249,
                1354: 2821,
                1355: 1297,
                1356: 1265,
                1357: 1091,
                1358: 2461,
                1359: 1062,
                1360: 1136,
                1361: 1508,
                1362: 2215,
                1451: 1927,
                1452: 1715,
                1453: 2148,
                1454: 1607,
                1455: 1158,
                1456: 766,
                1457: 1212,
                1458: 723,
                1551: 3845,
                1552: 2112,
                1553: 2581,
                1554: 2910,
                1555: 1765,
                1556: 1658,
                1557: 2361,
                1558: 918,
                1559: 1654,
                1560: 1594,
                1561: 2188,
                1562: 1707,
                1563: 1384,
                1564: 3612,
                1565: 1376,
                1566: 2532,
                1651: 1230,
                1652: 1707,
                1653: 410,
                1654: 1339,
                1655: 1622,
                1656: 678,
                1751: 2040,
                1752: 576,
                1753: 607,
                1754: 1753,
                1755: 1162,
                1756: 1954,
                1757: 637,
                1758: 1464,
                1759: 379,
                1760: 713,
                1761: 627,
                1762: 960,
                1763: 632,
                1764: 1557,
                2151: 1655,
                2152: 1182,
                2153: 929,
                2154: 1764,
                2155: 989,
                2156: 647,
                2157: 1357,
                2158: 432,
                2159: 1624,
                2251: 2139,
                2252: 1259,
                2253: 1636,
                2254: 850,
                2255: 2670,
                2256: 1896,
                2257: 1663,
                2258: 1705,
                2259: 1490,
                2351: 1342,
                2352: 2104,
                2353: 1751,
                2354: 776,
                2355: 1210,
                2356: 656,
                2357: 236,
                2358: 899,
                2359: 549,
                2360: 1352,
                2361: 1678,
                2451: 942,
                2452: 795,
                2453: 727,
                2454: 609,
                2455: 577,
                2456: 627,
                2457: 979,
                2458: 962,
                2459: 280,
                2460: 145,
                2461: 254,
                3151: 1619,
                3152: 1670,
                3153: 2851,
                3154: 1348,
                3155: 1651,
                3156: 2273,
                3157: 937,
                3158: 339,
                3159: 525,
                3160: 1757,
                3161: 2052,
                3162: 1143,
                3163: 1226,
                3164: 2057,
                3165: 999,
                3166: 1791,
                3251: 3247,
                3252: 1608,
                3253: 1651,
                3254: 936,
                3255: 1161,
                3256: 3030,
                3257: 2774,
                3258: 4309,
                3259: 668,
                3260: 971,
                3261: 1922,
                3262: 1786,
                3263: 2871,
                3351: 2785,
                3352: 1086,
                3353: 1166,
                3354: 1424,
                3355: 609,
                3356: 3292,
                3357: 2522,
                3358: 1102,
                3359: 838,
                3360: 1283,
                3361: 1431,
                3451: 3517,
                3452: 2574,
                3453: 2960,
                3454: 2489,
                3455: 3636,
                3456: 2098,
                3457: 2899,
                3458: 1988,
                3459: 837,
                3460: 1505,
                3461: 1225,
                3462: 1069,
                3463: 1331,
                3464: 1868,
                3465: 1337,
                3466: 539,
                4151: 1980,
                4152: 2116,
                4153: 1303,
                4154: 2734,
                4155: 1179,
                4156: 2063,
                4157: 970,
                4158: 1282,
                4159: 649,
                4160: 1467,
                4161: 1978,
                4251: 3243,
                4252: 294,
                4253: 1493,
                4254: 1033,
                4255: 2242,
                4256: 3784,
                4257: 119,
                4258: 810,
                4259: 1168,
                4260: 808,
                4261: 2584,
                4262: 756,
                4263: 1557,
                4351: 2675,
                4352: 1372,
                4353: 1357,
                4354: 783,
                4355: 903,
                4356: 422,
                4357: 670,
                4358: 759,
                4359: 458,
                4360: 1851,
                4361: 3705,
                5151: 1405,
                5152: 245,
                5153: 1318,
                5154: 500,
                5155: 995,
                5156: 512,
                5157: 1052,
                5158: 60,
                5159: 381,
                5160: 1754,
                5251: 626,
                5252: 1382,
                5253: 1037,
                5254: 408,
                5255: 3250,
                5256: 888,
                5257: 586,
                5258: 499,
                5259: 593,
                5351: 263,
                5352: 418,
                5353: 468,
                5355: 213,
                5356: 146,
                5357: 401,
                6151: 722,
                6152: 446,
                6153: 1209,
                6154: 2481,
                6155: 1503,
                6156: 654,
                6157: 1118,
                6159: 406,
                6160: 487,
                6161: 1661,
                6251: 1068,
                6252: 672,
                6253: 155,
                6254: 576,
                6255: 382,
                6351: 676,
                6352: 609,
                6353: 711,
                6354: 181,
                6355: 548,
                6356: 666,
                Total: 375886,
              },
            },
          ],
        },
      },
    },
  };

  const [toggleLayer, setToggleLayer] = useState(false);
  const [classNumber, setclassNumber] = useState(5);

  useEffect(() => {
    dispatch(initializeElections());
  }, [dispatch]);

  if (init)
    return (
      <CssVarsProvider theme={theme}>
        {/* <CssVarsProvider disableTransitionOnChange> */}
        <CssBaseline />
        <Layout.Root
        // sx={{
        //   gridTemplateColumns: {
        //     xs: "1fr",
        //     sm: "minmax(64px, 200px) minmax(450px, 1fr)",
        //     md: "minmax(160px, 300px) minmax(600px, 1fr) minmax(300px, 420px)",
        //   },
        // }}
        >
          <Layout.Header>
            <Navbar />
          </Layout.Header>
          <Layout.TopPanel>
            <MapTitle
              electionInfo={map[1]["election"]}
              parti={map[1]["parti"]}
            />
          </Layout.TopPanel>
          {/* <Layout.SidePanel>
            <ModalContents />
          </Layout.SidePanel> */}
          <Layout.Main>
            {/* {maps &&
              maps.map((mapObject) => {
                const [ID, map] = Object.entries(mapObject)[0];
                return (
                  <MapCard
                    key={ID}
                    id={ID}
                    map={map[1]}
                    electionInfo={map[0]}
                  />
                );
              })} */}
            <MapCard
              map={map[1]}
              electionInfo={map[1]["election"]}
              toggleLayer={toggleLayer}
              classNumber={classNumber}
            />
          </Layout.Main>
          {/* <Sheet
            sx={{
              display: "flex",
              flexDirection: "column",
              gap: 1.5,
            }}
          >
            <Box
              sx={{
                display: "flex",
                flexDirection: "row",
                padding: 4,
                justifyContent: "space-between",
              }}
            >
              <Typography>Carte Satellite:</Typography>{" "}
              <Switch
                checked={toggleLayer}
                onChange={(event) => setToggleLayer(event.target.checked)}
              />
            </Box>

            <Box
              sx={{
                display: "flex",
                flexDirection: "row",
                padding: 4,
                justifyContent: "space-between",
              }}
            >
              <Typography>Transparence:</Typography>{" "}
              <Slider
                marks
                valueLabelDisplay="on"
                value={fillValue}
                onChange={(event) => setFillValue(event.target.value)}
                max={10}
                sx={{ width: 260 }}
              />
            </Box>
            <Box
              sx={{
                display: "flex",
                flexDirection: "row",
                padding: 4,
                justifyContent: "space-between",
              }}
            >
              <Typography>Nombre de classes:</Typography>{" "}
              <Slider
                marks
                valueLabelDisplay="on"
                value={classNumber}
                onChange={(event) => setclassNumber(event.target.value)}
                min={4}
                max={12}
                sx={{ width: 260 }}
              />
            </Box>
          </Sheet> */}
        </Layout.Root>
      </CssVarsProvider>
    );
}

export default App;
